var e=(e,t,r)=>new Promise((a,s)=>{var i=e=>{try{o(r.next(e))}catch(t){s(t)}},n=e=>{try{o(r.throw(e))}catch(t){s(t)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,n);o((r=r.apply(e,t)).next())});import{W as t,r,X as a,Q as s,j as i,m as n,e as o,C as l,l as c,B as d,w as u,R as m,S as x,ah as h,a3 as g,c as y,a6 as p}from"./index-D8tqNdIF.js";const b=new class{getAllPoints(){return e(this,arguments,function*(e={}){try{const r=new URLSearchParams;e.materials&&e.materials.length>0&&r.append("materials",e.materials.join(",")),e.openNow&&r.append("openNow","true"),e.radius&&r.append("radius",e.radius);return(yield t.get(`/collection?${r.toString()}`)).data}catch(r){throw new Error("Erro ao buscar pontos de coleta: "+r.message)}})}getNearbyPoints(r,a,s=10){return e(this,null,function*(){try{return(yield t.get(`/collection/nearby/${r}/${a}?radius=${s}`)).data}catch(e){throw new Error("Erro ao buscar pontos próximos: "+e.message)}})}getPointById(r){return e(this,null,function*(){try{return(yield t.get(`/collection/${r}`)).data}catch(e){throw new Error("Erro ao buscar ponto de coleta: "+e.message)}})}getPointsByMaterial(r){return e(this,null,function*(){try{return(yield t.get(`/collection/material/${r}`)).data}catch(e){throw new Error("Erro ao buscar pontos por material: "+e.message)}})}getPointsByCity(r){return e(this,null,function*(){try{return(yield t.get(`/collection/city/${encodeURIComponent(r)}`)).data}catch(e){throw new Error("Erro ao buscar pontos por cidade: "+e.message)}})}calculateDistance(e,t,r,a){const s=this.toRadians(r-e),i=this.toRadians(a-t),n=Math.sin(s/2)*Math.sin(s/2)+Math.cos(this.toRadians(e))*Math.cos(this.toRadians(r))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))}toRadians(e){return e*(Math.PI/180)}filterPoints(e,t={}){let r=[...e];if(t.materials&&t.materials.length>0&&(r=r.filter(e=>e.materials.some(e=>t.materials.includes(e)))),t.userLocation&&t.radius&&(r=r.filter(e=>this.calculateDistance(t.userLocation.lat,t.userLocation.lng,e.latitude,e.longitude)<=t.radius)),t.openNow){const e=new Date,t=60*e.getHours()+e.getMinutes();r=r.filter(e=>{if(!e.schedule)return!0;const r=e.schedule.split("-");if(2===r.length){const e=this.timeToMinutes(r[0].trim()),a=this.timeToMinutes(r[1].trim());return t>=e&&t<=a}return!0})}return t.userLocation&&r.sort((e,r)=>this.calculateDistance(t.userLocation.lat,t.userLocation.lng,e.latitude,e.longitude)-this.calculateDistance(t.userLocation.lat,t.userLocation.lng,r.latitude,r.longitude)),r}timeToMinutes(e){const[t,r]=e.split(":").map(Number);return 60*t+r}getStatistics(){return e(this,null,function*(){try{return(yield t.get("/collection/statistics")).data}catch(e){throw new Error("Erro ao buscar estatísticas: "+e.message)}})}getPopularPoints(r=10){return e(this,null,function*(){try{return(yield t.get(`/collection/popular?limit=${r}`)).data}catch(e){throw new Error("Erro ao buscar pontos populares: "+e.message)}})}suggestPoints(r,a){return e(this,arguments,function*(e,r,a={}){try{return(yield t.post("/collection/suggest",{latitude:e,longitude:r,preferences:a})).data}catch(s){throw new Error("Erro ao sugerir pontos: "+s.message)}})}reportIssue(r,a){return e(this,null,function*(){try{return(yield t.post(`/collection/${r}/report`,a)).data}catch(e){throw new Error("Erro ao reportar problema: "+e.message)}})}ratePoint(r,a,s=""){return e(this,null,function*(){try{return(yield t.post(`/collection/${r}/rate`,{rating:a,comment:s})).data}catch(e){throw new Error("Erro ao avaliar ponto: "+e.message)}})}getPointRatings(r){return e(this,null,function*(){try{return(yield t.get(`/collection/${r}/ratings`)).data}catch(e){throw new Error("Erro ao buscar avaliações: "+e.message)}})}toggleFavorite(r){return e(this,null,function*(){try{return(yield t.post(`/collection/${r}/favorite`)).data}catch(e){throw new Error("Erro ao marcar favorito: "+e.message)}})}getFavorites(){return e(this,null,function*(){try{return(yield t.get("/collection/favorites")).data}catch(e){throw new Error("Erro ao buscar favoritos: "+e.message)}})}sharePoint(r,a="whatsapp"){return e(this,null,function*(){try{return(yield t.post(`/collection/${r}/share`,{platform:a})).data}catch(e){throw new Error("Erro ao compartilhar ponto: "+e.message)}})}getVisitHistory(){return e(this,null,function*(){try{return(yield t.get("/collection/visits")).data}catch(e){throw new Error("Erro ao buscar histórico: "+e.message)}})}registerVisit(r){return e(this,null,function*(){try{return(yield t.post(`/collection/${r}/visit`)).data}catch(e){throw new Error("Erro ao registrar visita: "+e.message)}})}collectPointsByQrCode(r){return e(this,null,function*(){try{return yield t.post("/disposals/qr-collect",{code:r})}catch(e){throw new Error(e.message||"Erro ao coletar pontos via QR code.")}})}},j=()=>{const[t,j]=r.useState(!1),[f,N]=r.useState(""),[w,v]=r.useState(""),[k,E]=r.useState(!1),[C,P]=r.useState(!1),[S,M]=r.useState(""),[R,$]=r.useState(0),[L,D]=r.useState([]),[I,O]=r.useState(!1),Q=r.useRef(null),{user:B}=a(),{addNotification:q}=s();r.useEffect(()=>{const e=localStorage.getItem("recentCodes");e&&D(JSON.parse(e))},[]);const T=()=>{if(j(!1),Q.current&&Q.current.srcObject){Q.current.srcObject.getTracks().forEach(e=>e.stop()),Q.current.srcObject=null}},V=t=>e(void 0,null,function*(){if(O(!0),M(""),$(0),!B)return M("Você precisa estar logado para coletar pontos."),P(!0),void O(!1);try{const e=yield b.collectPointsByQrCode(t);$(e.pointsEarned||0),E(!0),B&&e.pointsEarned&&(B.points=(B.points||0)+e.pointsEarned);const r=[{code:t,points:e.pointsEarned||0,date:(new Date).toISOString()},...L.slice(0,4)];D(r),localStorage.setItem("recentCodes",JSON.stringify(r)),v(""),N("")}catch(e){M(e.message||"Erro ao coletar pontos."),P(!0)}finally{O(!1)}}),A=()=>{E(!1),P(!1),M(""),$(0)};return i.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 dark:from-gray-900 dark:to-gray-800 p-4",children:[i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsxs(n.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-green-100 dark:bg-green-900 rounded-full mb-4",children:i.jsx(o,{className:"w-10 h-10 text-green-600 dark:text-green-400"})}),i.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"Coletar Pontos"}),i.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400",children:"Escaneie QR codes ou digite códigos das lixeiras automáticas"})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsx(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},children:i.jsx(l,{children:i.jsxs("div",{className:"text-center",children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Scanner QR Code"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Aponte a câmera para o QR Code da lixeira automática"}),i.jsxs("div",{className:"relative mb-6",children:[i.jsx("div",{className:"w-full h-64 bg-gray-100 dark:bg-gray-700 rounded-lg overflow-hidden border-2 border-dashed border-gray-300 dark:border-gray-600",children:t?i.jsx("video",{ref:Q,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}):i.jsx("div",{className:"flex items-center justify-center h-full",children:i.jsx(c,{className:"w-16 h-16 text-gray-400"})})}),t&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:i.jsxs("div",{className:"w-48 h-48 border-2 border-green-500 rounded-lg relative",children:[i.jsx("div",{className:"absolute inset-0 border-2 border-green-500 rounded-lg animate-pulse"}),i.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-green-500"}),i.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-green-500"}),i.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-green-500"}),i.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-green-500"})]})})]}),i.jsx("div",{className:"space-y-4",children:t?i.jsxs("div",{className:"space-y-2",children:[i.jsxs(d,{onClick:T,className:"w-full",variant:"outline",children:[i.jsx(u,{className:"mr-2"}),"Parar Scanner"]}),f&&i.jsxs(d,{onClick:()=>{f&&V(f)},className:"w-full",variant:"primary",children:[i.jsx(m,{className:"mr-2"}),"Usar Código: ",f]})]}):i.jsxs(d,{onClick:()=>e(void 0,null,function*(){try{j(!0),N("");const e=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});Q.current&&(Q.current.srcObject=e),setTimeout(()=>{N(""),T()},3e3)}catch(e){console.error("Erro ao acessar câmera:",e),M("Não foi possível acessar a câmera. Verifique as permissões."),P(!0),j(!1)}}),className:"w-full",variant:"primary",children:[i.jsx(c,{className:"mr-2"}),"Iniciar Scanner"]})})]})})}),i.jsx(n.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.3},children:i.jsx(l,{children:i.jsxs("div",{className:"text-center",children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Código Manual"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Digite o código que aparece na lixeira automática"}),i.jsxs("form",{onSubmit:e=>{e.preventDefault(),w.trim()&&V(w.trim())},className:"space-y-4",children:[i.jsx("div",{children:i.jsx("input",{type:"text",id:"manual-code",name:"manualCode",value:w,onChange:e=>v(e.target.value.toUpperCase()),placeholder:"Ex: QR-ABC123",className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-center text-lg font-mono",disabled:I,maxLength:10})}),i.jsx(d,{type:"submit",className:"w-full",variant:"primary",disabled:!w.trim()||I,children:I?i.jsxs(i.Fragment,{children:[i.jsx(x,{className:"mr-2 animate-spin"}),"Processando..."]}):i.jsxs(i.Fragment,{children:[i.jsx(h,{className:"mr-2"}),"Coletar Pontos"]})})]}),i.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[i.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Como funciona?"}),i.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[i.jsx("li",{children:"• Cada código só pode ser usado uma vez"}),i.jsx("li",{children:"• Ganhe 30-80 pontos por descarte"}),i.jsx("li",{children:"• Códigos são gerados automaticamente pelas lixeiras"}),i.jsx("li",{children:"• Após uso, o código fica inválido"})]})]})]})})})]}),L.length>0&&i.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"mt-8",children:i.jsxs(l,{children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Códigos Recentes"}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:L.map((e,t)=>i.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-mono font-bold text-green-600 dark:text-green-400",children:e.code}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:new Date(e.date).toLocaleDateString()})]}),i.jsxs("div",{className:"flex items-center text-green-600 dark:text-green-400",children:[i.jsx(g,{className:"mr-1"}),i.jsxs("span",{className:"font-bold",children:["+",e.points]})]})]})},t))})]})}),i.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"mt-8",children:i.jsx(l,{children:i.jsxs("div",{className:"text-center",children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Simulação de Lixeira Automática"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Veja como funciona o processo na lixeira automática"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mx-auto mb-3",children:i.jsx(y,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),i.jsx("h3",{className:"font-semibold mb-2",children:"1. Descarte"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Coloque o material na lixeira"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto mb-3",children:i.jsx(o,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),i.jsx("h3",{className:"font-semibold mb-2",children:"2. Código"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Lixeira gera código único"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-yellow-100 dark:bg-yellow-900 rounded-full flex items-center justify-center mx-auto mb-3",children:i.jsx(g,{className:"w-8 h-8 text-yellow-600 dark:text-yellow-400"})}),i.jsx("h3",{className:"font-semibold mb-2",children:"3. Pontos"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Escaneie e ganhe pontos"})]})]})]})})})]}),i.jsx(p,{isOpen:k,onClose:A,children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(m,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),i.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Pontos Coletados!"}),i.jsxs("p",{className:"text-4xl font-bold text-green-600 dark:text-green-400 mb-4",children:["+",R," pontos"]}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Parabéns! Você contribuiu para um mundo mais sustentável."}),i.jsx(d,{onClick:A,className:"w-full",children:"Continuar"})]})}),i.jsx(p,{isOpen:C,onClose:A,children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(u,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),i.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Erro"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:S}),i.jsx(d,{onClick:A,className:"w-full",children:"Tentar Novamente"})]})})]})};export{j as default};
